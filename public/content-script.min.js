var runtimePort=chrome.runtime.connect({name:"content-script"}),peer;runtimePort.onMessage.addListener(function(e){e&&e.messageFromContentScript1234&&(e.sdp&&peer.setRemoteDescription(new RTCSessionDescription(e.sdp)),e.stopStream&&stream&&(stream.getAudioTracks()[0].stop(),stream=null,audioPlayer&&(audioPlayer.pause(),audioPlayer=null),peer&&(peer.close(),peer=null)))});var stream,audioPlayer;navigator.webkitGetUserMedia({audio:!0},function(e){stream=e,audioPlayer=document.createElement("audio"),audioPlayer.muted=!0,audioPlayer.volume=0,audioPlayer.src=URL.createObjectURL(stream),(document.body||document.documentElement).appendChild(audioPlayer),audioPlayer.play(),peer=new webkitRTCPeerConnection(null),peer.addStream(stream),peer.onicecandidate=function(e){e&&!e.candidate&&runtimePort.postMessage({sdp:peer.localDescription,messageFromContentScript1234:!0})},peer.oniceconnectionstatechange=function(){peer&&console.debug("ice-state",{iceConnectionState:peer.iceConnectionState,iceGatheringState:peer.iceGatheringState,signalingState:peer.signalingState})},peer.createOffer(function(e){peer.setLocalDescription(e)},function(){},{optional:[],mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}})},function(){});