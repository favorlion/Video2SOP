function handleSuccess(e){window.stream=e;var t=window.soundMeter=new SoundMeter(window.audioContext);t.connectToSource(e,function(e){return e?void alert(e):void setInterval(function(){$("#meter").css({zoom:1+t.instant})},10)})}function handleError(e){console.log("navigator.getUserMedia error: ",e)}function updateGradient(){var e=colors[colorIndices[0]],t=colors[colorIndices[1]],o=colors[colorIndices[2]],n=colors[colorIndices[3]],r=1-step,i=Math.round(r*e[0]+step*t[0]),c=Math.round(r*e[1]+step*t[1]),a=Math.round(r*e[2]+step*t[2]),s="rgb("+i+","+c+","+a+")",d=Math.round(r*o[0]+step*n[0]),u=Math.round(r*o[1]+step*n[1]),l=Math.round(r*o[2]+step*n[2]),p="rgb("+d+","+u+","+l+")";$("#meter").css({background:"-webkit-gradient(linear, left top, right top, from("+s+"), to("+p+"))"}),step+=gradientSpeed,step>=1&&(step%=1,colorIndices[0]=colorIndices[1],colorIndices[2]=colorIndices[3],colorIndices[1]=(colorIndices[1]+Math.floor(1+Math.random()*(colors.length-1)))%colors.length,colorIndices[3]=(colorIndices[3]+Math.floor(1+Math.random()*(colors.length-1)))%colors.length)}String.prototype.toMMSS=function(){var e=parseInt(this,10),t=Math.floor(e/60),o=e-60*t;return o<10&&(o="0"+o),t<10&&(t="0"+t),t+":"+o};var recognized="",recognition=new webkitSpeechRecognition;recognition.continuous=!0,recognition.interimResults=!0,recognition.onresult=function(e){var t=e.results[e.results.length-1];t.isFinal&&(recognized+=t[0].transcript,console.log(recognized),$(".recognition").typed({strings:[t[0].transcript],typeSpeed:5}))},recognition.onerror=function(e){console.debug(e.error)};var timer=0,timerOutput=document.querySelector(".timer");chrome.runtime.onMessage.addListener(function(e,t,o){"startRecording"==e.action&&setInterval(function(){timer++,timerOutput.innerHTML=timer.toString().toMMSS()},1e3),"getVoice"==e.action&&o({recordedVoice:recognized})}),recognition.lang="en-US",recognition.start();try{window.AudioContext=window.AudioContext||window.webkitAudioContext,window.audioContext=new AudioContext}catch(e){alert("Web Audio API not supported.")}var constraints=window.constraints={audio:!0,video:!1};navigator.mediaDevices.getUserMedia(constraints).then(handleSuccess).catch(handleError);var runtimePort=chrome.runtime.connect({name:"content-script"}),peer;runtimePort.onMessage.addListener(function(e){e&&e.messageFromContentScript1234&&(e.sdp&&peer.setRemoteDescription(new RTCSessionDescription(e.sdp)),e.stopStream&&stream&&(stream.getAudioTracks()[0].stop(),stream=null,audioPlayer&&(audioPlayer.pause(),audioPlayer=null),peer&&(peer.close(),peer=null)))});var stream,audioPlayer;navigator.webkitGetUserMedia({audio:!0},function(e){stream=e,audioPlayer=document.createElement("audio"),audioPlayer.muted=!0,audioPlayer.volume=0,audioPlayer.src=URL.createObjectURL(stream),(document.body||document.documentElement).appendChild(audioPlayer),audioPlayer.play(),peer=new webkitRTCPeerConnection(null),peer.addStream(stream),peer.onicecandidate=function(e){e&&!e.candidate&&runtimePort.postMessage({sdp:peer.localDescription,messageFromContentScript1234:!0})},peer.oniceconnectionstatechange=function(){peer&&console.debug("ice-state",{iceConnectionState:peer.iceConnectionState,iceGatheringState:peer.iceGatheringState,signalingState:peer.signalingState})},peer.createOffer(function(e){peer.setLocalDescription(e)},function(){},{optional:[],mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}})},function(){});var colors=new Array([62,35,255],[60,255,60],[255,35,98],[45,175,230],[255,0,255],[255,128,0]),step=0,colorIndices=[0,1,2,3],gradientSpeed=.005;setInterval(updateGradient,10);